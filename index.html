<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üóíÔ∏è RandkoPlaner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #007bff;
            color: white;
            padding: 20px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            margin: 20px auto;
            width: 300px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input, button {
            width: calc(100% - 20px);
            max-width: 300px;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[type="datetime-local"] {
            width: 250px;
        }

        button {
            background-color: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .activities {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 20px 0;
        }

        .activity {
            width: 45%;
            margin-bottom: 20px;
            cursor: pointer;
            text-align: center;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 5px;
        }

        .activity img {
            max-width: 100%;
            border-radius: 8px;
        }

        .activity span {
            display: block;
            margin-top: 8px;
            font-weight: bold;
        }

        .activity.selected {
            border-color: #007bff;
            background-color: #f0f8ff;
        }

        #custom-text-container {
            display: none;
            margin-top: 15px;
        }

        footer {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        #summary {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>üóíÔ∏è RandkoPlaner</h1>
        <h3 id="greetingText">Hejka!</h3>
    </header>

    <form id="appointmentForm" onsubmit="submitForm(event)">
        <!-- Krok 1: Wyb√≥r daty i godziny -->
        <div class="step active" id="step-1">
            <label for="datetime">üïë Kiedy masz czas?</label>
            <input type="datetime-local" id="datetime" name="Data_i_godzina" required>
            <button type="button" onclick="nextStep(2)">Dalej</button>
        </div>

        <!-- Krok 2: Wyb√≥r aktywno≈õci -->
        <div class="step" id="step-2">
            <label>üë´ Co chcemy robiƒá?</label>
            <div class="activities">
                <label class="activity">
                    <input type="radio" name="Aktywno≈õƒá" value="Jedzonko" required hidden>
                    <img src="https://cdn.pixabay.com/photo/2021/01/22/18/00/shrimp-5940735_1280.jpg" alt="Jedzonko">
                    <span>Jedzonko</span>
                </label>
                <label class="activity">
                    <input type="radio" name="Aktywno≈õƒá" value="Spacer" required hidden>
                    <img src="https://cdn.pixabay.com/photo/2018/06/12/21/26/person-3471540_1280.jpg" alt="Spacer">
                    <span>Spacer</span>
                </label>
                <label class="activity">
                    <input type="radio" name="Aktywno≈õƒá" value="Krƒôgle" required hidden>
                    <img src="https://cdn.pixabay.com/photo/2015/01/11/21/25/bowling-596766_1280.jpg" alt="Krƒôgle">
                    <span>Krƒôgle</span>
                </label>
                <label class="activity">
                    <input type="radio" name="Aktywno≈õƒá" value="Kino" required hidden>
                    <img src="https://cdn.pixabay.com/photo/2017/07/13/23/11/cinema-2502213_1280.jpg" alt="Kino">
                    <span>Kino</span>
                </label>
                <label class="activity">
                    <input type="radio" name="Aktywno≈õƒá" value="Kawa" required hidden>
                    <img src="https://cdn.pixabay.com/photo/2022/01/31/15/18/coffee-6984075_1280.jpg" alt="Kawa">
                    <span>Kawa</span>
                </label>
                <label class="activity">
                    <input type="radio" name="Aktywno≈õƒá" value="Zaproponuj w≈Çasne" id="custom-option" hidden>
                    <img src="https://cdn.pixabay.com/photo/2015/05/31/13/45/working-791849_1280.jpg" alt="Zaproponuj w≈Çasne">
                    <span>Zaproponuj w≈Çasne</span>
                </label>
            </div>
            <div id="custom-text-container">
                <label for="custom-activity">Wpisz swojƒÖ propozycjƒô:</label>
                <input type="text" id="custom-activity" name="Aktywno≈õƒá_w≈Çasna" placeholder="Twoja propozycja">
            </div>
            <button type="button" onclick="prevStep(1)">Wstecz</button>
            <button type="button" onclick="nextStep(3)" id="next-step-2" disabled>Dalej</button>
        </div>

        <!-- Krok 3: Podsumowanie -->
        <div class="step" id="step-3">
            <h2>Dziƒôkujƒô üíå</h2>
            <p>Twoja randka zosta≈Ça zaplanowana</p>
            <p id="summary-info"></p>
            <img src="https://media.tenor.com/-ufrqpl5cp0AAAAM/test.gif" alt="Podziƒôkowanie" style="max-width: 100px; margin-top: 10px; margin-bottom: 10px;">
            <button onclick="addToCalendar()">üóìÔ∏è Dodaj do kalendarza</button>
        </div>
    </form>

    <footer>
        <p>Stworzono z ‚ù§Ô∏è</p>
    </footer>

    <script>
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const userName = getUrlParameter('imie');
        document.getElementById("greetingText").innerHTML = "Hejka" + " " + userName + "!";

        // Funkcje do przechodzenia miƒôdzy krokami
        function nextStep(step) {
            const datetime = document.getElementById('datetime').value;
            const activitySelected = document.querySelector('input[name="Aktywno≈õƒá"]:checked');

            if (step === 2 && !datetime) {
                alert('Proszƒô wybraƒá datƒô.');
                return;
            }

            if (step === 3 && !activitySelected) {
                alert('Proszƒô wybraƒá aktywno≈õƒá.');
                return;
            }

            document.querySelectorAll('.step').forEach(stepDiv => {
                stepDiv.classList.remove('active');
            });

            document.getElementById(`step-${step}`).classList.add('active');

            if (step === 3) {
                submitForm();
            }
        }

        function prevStep(step) {
            document.querySelectorAll('.step').forEach(stepDiv => {
                stepDiv.classList.remove('active');
            });

            document.getElementById(`step-${step}`).classList.add('active');
        }

        document.getElementById('custom-option').addEventListener('change', function () {
            const customTextContainer = document.getElementById('custom-text-container');
            customTextContainer.style.display = this.checked ? 'block' : 'none';
        });

        document.querySelectorAll('input[name="Aktywno≈õƒá"]').forEach(radio => {
            radio.addEventListener('change', function () {
                document.getElementById('next-step-2').disabled = false;

                if (this.value !== 'Zaproponuj w≈Çasne') {
                    document.getElementById('custom-text-container').style.display = 'none';
                }

                document.querySelectorAll('.activity').forEach(activity => {
                    activity.classList.remove('selected');
                });

                this.parentElement.classList.add('selected');
            });
        });

        function submitForm(event) {
            if (event) {
                event.preventDefault();
            }

            const datetime = document.getElementById('datetime').value;
            const activity = document.querySelector('input[name="Aktywno≈õƒá"]:checked').value;
            const customActivity = document.getElementById('custom-activity') ? document.getElementById('custom-activity').value : '';

            const finalActivity = activity === 'Zaproponuj w≈Çasne' ? customActivity : activity;

            if (!finalActivity.trim()) {
                alert('Nie podano aktywno≈õci.');
                return;
            }

            const summaryInfo = `Jeste≈õmy um√≥wieni <b>${datetime}</b> na <b>${finalActivity}</b>.`;

            document.getElementById('summary-info').innerHTML = summaryInfo;

            // Wysy≈Çanie danych do Formspree
            fetch('https://formspree.io/f/meoonyvk', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    Data_i_godzina: datetime,
                    Aktywno≈õƒá: finalActivity,
                    Imie: userName
                })
            })
            .then(response => {
                if (response.ok) {
                    console.log('Formularz zosta≈Ç pomy≈õlnie wys≈Çany!');
                } else {
                    console.log('WystƒÖpi≈Ç problem podczas wysy≈Çania formularza. Spr√≥buj ponownie.');
                }
            })
            .catch(error => {
                console.log('B≈ÇƒÖd podczas wysy≈Çania formularza: ' + error.message);
            });
        }

        function addToCalendar() {
            const datetime = document.getElementById('datetime').value;
            const activity = document.querySelector('input[name="Aktywno≈õƒá"]:checked').value;
            const customActivity = document.getElementById('custom-activity') ? document.getElementById('custom-activity').value : '';

            const finalActivity = activity === 'Zaproponuj w≈Çasne' ? customActivity : activity;

            const eventDetails = encodeURIComponent(finalActivity);
            const startTime = new Date(datetime).toISOString().replace(/-|:|\.\d\d\d/g, "");

            const calendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${eventDetails}&dates=${startTime}/${startTime}`;
            window.open(calendarUrl, '_blank');
        }
    </script>
</body>
</html>
